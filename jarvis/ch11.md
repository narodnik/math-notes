---
header-includes: |
    - \newcommand{\leg}[2]{\left( \frac{#1}{#2} \right)}
---
# Quadratic Sieve

$$ xÂ² â‰¡ N \mod{p} $$
$$ x â‰¡ a_p \mod{p} \; \textrm{ or } \; x â‰¡ b_p \mod{p} $$

$$ xÂ² - 227179 â‰¡ 0 \mod{5} $$
$$ x â‰¡ 2, 3 \mod{5} $$
$$ (âŸ¨5âŸ© + 2)Â² - N = âŸ¨5âŸ© $$

```
$ sage ch11-quadratic-sieve.sage
---  -----  ---------------------  ------------------------------
470  -6279  -1 * 3 * 7 * 13 * 23   [1, 0, 1, 0, 1, 0, 1, 0, 0, 1]
473  -3450  -1 * 2 * 3 * 5^2 * 23  [1, 1, 1, 0, 0, 0, 0, 0, 0, 1]
477    350  2 * 5^2 * 7            [0, 1, 0, 0, 1, 0, 0, 0, 0, 0]
482   5145  3 * 5 * 7^3            [0, 0, 1, 1, 1, 0, 0, 0, 0, 0]
493  15870  2 * 3 * 5 * 23^2       [0, 1, 1, 1, 0, 0, 0, 0, 0, 0]
---  -----  ---------------------  ------------------------------
212460Â² â‰¡ 169050Â² (mod 227179)
227179 = 157 Ã— 1447
```

So we see 5 divides all $x$ that are of the form $5a + 2$ or $5a + 3$.

# Exercise 11.4: factorise 1679

We are given $(a, b) = (-1, 2), (5, 4)$ and $1679 = 41Â² - 2$.

$$ â„¤[\âˆš{2}] â†’ â„¤/âŸ¨1679âŸ© $$
$$ a + b \âˆš{2} â†’ a + 41 b $$

$$ N((-1, 2)) = N((5, 4)) = -7 $$
$$ ğœ™((-1, 2)) = 81 = 3â´, \qquad N((5, 4)) = 169 = 13Â² $$

\begin{align*}
(-1 + 2 \âˆš{2})(5 + 4 \âˆš{2}) &= 11 + 6 \âˆš{2} \\
    &= (3 + \âˆš{2})Â²
\end{align*}
$$ ğœ™(3 + \âˆš{2}) = 44 $$

$$ â‡’ 44Â² = (3Â² 13)Â² \mod{1679} $$

```python
sage: var("x")
x
sage: R.<a> = NumberField(x^2 - 2)
sage: sqrt((-1 + 2*a)*(5 + 4*a))
a + 3
sage: (3 + a)^2
6*a + 11
sage: 6*41 + 11
257
sage: Mod(44, 1679)^2 == 257^2
False
sage: Mod(44, 1679)^2
257
sage: 3^2 * 13
117
sage: Mod(44, 1679)^2 == 117^2
True

sage: gcd(1679, 117 + 44)
23
sage: gcd(1679, 117 - 44)
73
sage: 23 * 73
1679
```

# $aÂ² - 6bÂ²$ is divisible by 7 means 6 is a square modulo 7

1. $(cÂ²)â»Â¹ = (câ»Â¹)Â²$ so we see the inverse of a square is also a square.
2. $aÂ² - 6bÂ² â‰¡ 0 \mod{7} â‡’ aÂ² bâ»Â² â‰¡ 6 \mod{7}$
3. `kronecker(6, 7) = -1`, so 7 cannot be a divisor of the norm.

By the same argument, we can see that 6 modulo $p$ must be a quadratic residue.

# Prime Ideal $ğ”­ = âŸ¨p, \âˆš{d} - râŸ©$

We saw in chapter 5 that
$$ â„¤_K / ğ”­_i â‰… ğ”½_p[X] / âŸ¨\bar{g}_i(X)âŸ© $$
so the quotient ring contains $ğ”½_p$.

We know $â„¤_K / ğ”­$ is a finite field with a cardinality measured by the norm which is a power of $p$.
All finite fields contain a subfield $ğ”½_p$ by Cauchy. In this subfield $p$ is the zero.

Since $p âˆˆ ğ”­$, we see that $ğœ™(â„¤) = ğ”½_p$, which is the restriction of $ğœ™|_â„¤$.

1. The ideal $ğ”­$ is a factorization of $âŸ¨a + b\âˆš{d}âŸ©$, where $N(âŸ¨a + b\âˆš{d}âŸ©) = aÂ² - dbÂ²$.
2. We assume $p | N(âŸ¨a + b\âˆš{d}âŸ©)$, which means $p âˆˆ âŸ¨a + b\âˆš{d}âŸ© âŠ† ğ”­$.
3. Consider the map $ğœ™$ which is a homomorphism.
4. We see that $ğœ™(a + b\âˆš{d}) = ğ”­$. Rearranging this, we get $ğœ™(\âˆš{d}) = -ğœ™(abâ»Â¹)$.
5. We showed in `ch9.md` (title $â„¤_K = â„¤ + Ï€â„¤_K$) that the cosets of $â„¤_K/ğ”­$ are of the form
   $a + ğ”­$ where $a âˆˆ \{ 0, â€¦, p - 1 \}$.
6. Finally we have $a + b \âˆš{d} = pq + (a - pq) + b \âˆš{d}$, where $|a - pq| < p$.
   Then we can set $r = abâ»Â¹$, and we see $ğ”­ = âŸ¨p, \âˆš{d} - râŸ©$.
6. Finally we have $a + b \âˆš{d} = b (abâ»Â¹ + \âˆš{d})$, and minus some multiple of $p$, so
   $r â‰¡ -abâ»Â¹ \mod{p}$.

$$ ğ”­ = âŸ¨p, \âˆš{d} - râŸ© $$
$ğ”­$ has norm $p$ due to its coset representation, and the right hand side also has norm $p$
due to how we constructed it.

## Restriction of $ğœ™$ to $â„¤$ is $ğ”½_p$

Let $a, a'$ be such that $a â‰¡ a' \mod{p} â‡’ a â‰¡ a' \mod{ğ”­}$ since $p âˆˆ ğ”­$.

Likewise $a â‰¡ a' \mod{ğ”­} â‡’ âŸ¨a - a'âŸ© âŠ† ğ”­$ but $N(ğ”­) = páµ â‡’ N(âŸ¨a - a'âŸ©) | páµ$
so $p|a - a' â‡’ a â‰¡ a' \mod{p}$.

So the cosets of $a + ğ”­$ with $a âˆˆ \{ 0, â€¦, p - 1 \}$ are distinct.

## All Cases

1. If $p > 2, \leg{d}{p} = 1$, or $p = 2, d â‰¡ 1 \mod{8}$ then
   $$ âŸ¨pâŸ© = ğ”­â‚ ğ”­â‚‚ $$
2. If $p > 2, p | d$, or $p = 2, d â‰¡ 2, 3 \mod{4}$ then
   $$ âŸ¨pâŸ© = ğ”­Â² $$
3. If $p > 2, \leg{d}{p} = 1$, or $p = 2, d â‰¡ 5 \mod{8}$ then $âŸ¨pâŸ©$ is a prime ideal of $â„¤_K$.

## $\leg{r}{p} = 1 â‡’ âŸ¨pâŸ© = ğ”­â‚ ğ”­â‚‚$

Let $ğ”­â‚ = âŸ¨p, r + \âˆš{d}âŸ©, ğ”­â‚‚ = âŸ¨p, r - \âˆš{d}âŸ©$.

We prove first $ğ”­â‚ â‰  ğ”­â‚‚$. Suppose $ğ”­â‚ = ğ”­â‚‚$, then
$2a = (r + \âˆš{d}) + (r - \âˆš{d}) âˆˆ ğ”­â‚$. But $2a âˆˆ â„¤$ so $2a âˆˆ ğ”­â‚ âˆ© â„¤ = âŸ¨pâŸ©$.
Hence $p|2a$ but this is impossible since $p$ is odd.

Now multiply $ğ”­â‚ ğ”­â‚‚$
\begin{align*}
ğ”­â‚ ğ”­â‚‚ &= âŸ¨p, r + \âˆš{d}âŸ© âŸ¨p, r - \âˆš{d}âŸ© \\
    &= âŸ¨pâŸ© I
\end{align*}
$$ I = âŸ¨p, r + \âˆš{d}, r - \âˆš{d}, (rÂ² - d)/pâŸ© $$
Since $\gcd(2r, p) = 1$, there are integers $x, y$ such that
$$ xp + y(2r) = 1 $$
$$ â‡’ 1 = xp + y(2r) = xp + (r + \âˆš{d}) + (r - \âˆš{d}) âˆˆ I $$
$$ I = âŸ¨1âŸ© $$

$$ âŸ¨pâŸ© = ğ”­â‚ ğ”­â‚‚ $$

